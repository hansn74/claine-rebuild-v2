<story-context id="2-12-empty-states-onboarding-ux" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>12</storyId>
    <title>Empty States &amp; Onboarding UX</title>
    <status>drafted</status>
    <generatedAt>2025-12-12</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/2-12-empty-states-onboarding-ux.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>new user</asA>
    <iWant>clear guidance when getting started</iWant>
    <soThat>I understand how to use Claine</soThat>
    <tasks>
      <task id="1" ac="2,3">Create Empty State Component Library
        <subtask>1.1 Create src/components/common/EmptyState.tsx base component with icon, title, description, action slots</subtask>
        <subtask>1.2 Create EmptyInbox.tsx variant: "You're all caught up!" message with checkmark icon</subtask>
        <subtask>1.3 Create EmptySearch.tsx variant: "No results found" with search tips</subtask>
        <subtask>1.4 Create EmptyFolder.tsx variant: Generic empty folder state (Sent, Drafts, Archive, Trash)</subtask>
        <subtask>1.5 Add illustration/icon assets (use Lucide icons: Inbox, Search, FolderOpen, CheckCircle)</subtask>
        <subtask>1.6 Write unit tests for EmptyState component variants</subtask>
      </task>
      <task id="2" ac="1">Implement Welcome Screen / Onboarding Flow
        <subtask>2.1 Create src/components/onboarding/WelcomeScreen.tsx with Claine branding</subtask>
        <subtask>2.2 Add "Connect Email Account" CTA button prominently displayed</subtask>
        <subtask>2.3 Show feature highlights (Offline-first, Fast search, Keyboard shortcuts)</subtask>
        <subtask>2.4 Create useOnboardingState hook to track first-launch status in localStorage</subtask>
        <subtask>2.5 Integrate with existing AccountManager to trigger OAuth flow</subtask>
        <subtask>2.6 Add E2E test for first-launch welcome screen flow</subtask>
      </task>
      <task id="3" ac="4">Create Loading State Components
        <subtask>3.1 Extend existing LoadingFallback.tsx with progress variants</subtask>
        <subtask>3.2 Create SyncProgress.tsx component showing sync status</subtask>
        <subtask>3.3 Add estimated time remaining calculation based on sync rate</subtask>
        <subtask>3.4 Create skeleton loading states for inbox list</subtask>
        <subtask>3.5 Add indeterminate and determinate progress bar variants</subtask>
        <subtask>3.6 Write unit tests for loading components</subtask>
      </task>
      <task id="4" ac="5">Implement Error State Components
        <subtask>4.1 Create src/components/common/ErrorState.tsx base component</subtask>
        <subtask>4.2 Create specific error variants: NetworkError, AuthError, SyncError</subtask>
        <subtask>4.3 Integrate with ErrorBoundary.tsx for component-level error recovery</subtask>
        <subtask>4.4 Add error logging integration with existing logger service</subtask>
        <subtask>4.5 Write unit tests for error states</subtask>
      </task>
      <task id="5" ac="6">Implement First-Time Tooltips System
        <subtask>5.1 Create src/hooks/useFirstTimeTooltip.ts hook</subtask>
        <subtask>5.2 Create FirstTimeTooltip.tsx component with dismiss functionality</subtask>
        <subtask>5.3 Store dismissed tooltip IDs in localStorage</subtask>
        <subtask>5.4 Add tooltips for key features (keyboard shortcuts, search, archive, compose)</subtask>
        <subtask>5.5 Position tooltips correctly near target elements</subtask>
        <subtask>5.6 Write unit tests for tooltip visibility and dismiss logic</subtask>
      </task>
      <task id="6" ac="1,2,3">Integrate Empty States into Existing Views
        <subtask>6.1 Add EmptyInbox to InboxView when no emails</subtask>
        <subtask>6.2 Add EmptySearch to SearchResults when no results</subtask>
        <subtask>6.3 Add EmptyFolder to folder views</subtask>
        <subtask>6.4 Show WelcomeScreen when no accounts connected</subtask>
        <subtask>6.5 Ensure smooth transitions between states</subtask>
        <subtask>6.6 Write integration tests for state transitions</subtask>
      </task>
      <task id="7" ac="1-6">Accessibility &amp; Testing
        <subtask>7.1 Add ARIA labels to all empty state components</subtask>
        <subtask>7.2 Ensure focus management for modal tooltips</subtask>
        <subtask>7.3 Add screen reader announcements for state changes</subtask>
        <subtask>7.4 Write E2E tests covering onboarding and empty state flows</subtask>
        <subtask>7.5 Test with keyboard-only navigation</subtask>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">Welcome screen on first launch with "Connect Email" CTA</criterion>
    <criterion id="2">Empty inbox state: "You're all caught up" with calm affirmation</criterion>
    <criterion id="3">Empty search results: Helpful message with search tips</criterion>
    <criterion id="4">Loading states: Progress indicators with estimated time</criterion>
    <criterion id="5">Error states: Clear messages with actionable next steps</criterion>
    <criterion id="6">Tooltips for first-time interactions (dismissible)</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/epics/epic-2-offline-first-email-client-with-attributes.md</path>
        <title>Epic 2: Offline-First Email Client</title>
        <section>Story 2.12</section>
        <snippet>Story 2.12 defines empty states and onboarding UX including welcome screen, empty inbox, empty search results, loading states, error states, and first-time tooltips.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-specification.md</path>
        <title>UX Design Specification</title>
        <section>Visual Foundation</section>
        <snippet>Color system uses Cyan primary (#06B6D4), Slate neutrals. Typography is Inter Variable 14-16px. Spacing uses 4px base unit with 8px rhythm. Border radius 4-8px for components.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-specification.md</path>
        <title>UX Design Specification</title>
        <section>Design Foundation</section>
        <snippet>Keyboard-first with command palette. AI invisible by default. Tone is calm, direct, reassuring. Empty state as encouragement (Notion-inspired warmth).</snippet>
      </doc>
      <doc>
        <path>docs/testing.md</path>
        <title>Testing Infrastructure</title>
        <section>Test Structure</section>
        <snippet>Unit tests use Vitest. E2E tests use Playwright. Tests follow tagging convention. Component tests in src/components/*/__tests__/.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>src/components/common/LoadingFallback.tsx</path>
        <kind>component</kind>
        <symbol>LoadingSpinner, PageLoadingFallback, DialogLoadingFallback, ComposeLoadingFallback, SearchLoadingFallback, ThreadDetailLoadingFallback, EmailListLoadingFallback</symbol>
        <lines>1-213</lines>
        <reason>Existing loading/skeleton patterns to extend for progress variants and additional empty states</reason>
      </artifact>
      <artifact>
        <path>src/components/common/ErrorBoundary.tsx</path>
        <kind>component</kind>
        <symbol>ErrorBoundary</symbol>
        <lines>1-236</lines>
        <reason>Existing error UI pattern with retry/reload buttons, logger integration, and Sentry reporting to follow for ErrorState components</reason>
      </artifact>
      <artifact>
        <path>src/components/search/SearchResults.tsx</path>
        <kind>component</kind>
        <symbol>SearchResults</symbol>
        <lines>82-93</lines>
        <reason>Has existing empty state pattern with emptyMessage prop to enhance with search tips</reason>
      </artifact>
      <artifact>
        <path>src/context/ShortcutContext.tsx</path>
        <kind>context</kind>
        <symbol>ShortcutProvider, useShortcuts</symbol>
        <reason>Pattern for context-based state management, localStorage persistence for vim mode preference</reason>
      </artifact>
      <artifact>
        <path>src/hooks/useEmailShortcut.ts</path>
        <kind>hook</kind>
        <symbol>useEmailShortcut, useNavigationShortcuts, useActionShortcuts</symbol>
        <reason>Pattern for custom hooks with localStorage persistence to follow for useOnboardingState and useFirstTimeTooltip</reason>
      </artifact>
      <artifact>
        <path>src/components/ShortcutOverlay/ShortcutOverlay.tsx</path>
        <kind>component</kind>
        <symbol>ShortcutOverlay</symbol>
        <reason>Modal overlay pattern with focus trap, escape handling for tooltip modal implementation</reason>
      </artifact>
      <artifact>
        <path>src/services/logger/index.ts</path>
        <kind>service</kind>
        <symbol>logger, captureException</symbol>
        <reason>Logging service for error state integration</reason>
      </artifact>
      <artifact>
        <path>src/components/account/AccountManager.tsx</path>
        <kind>component</kind>
        <symbol>AccountManager</symbol>
        <reason>Existing account management for OAuth flow integration in welcome screen</reason>
      </artifact>
      <artifact>
        <path>src/utils/cn.ts</path>
        <kind>utility</kind>
        <symbol>cn</symbol>
        <reason>Class name utility for consistent Tailwind class merging</reason>
      </artifact>
    </code>
    <dependencies>
      <node>
        <package name="react" version="19.2" />
        <package name="react-dom" version="19.2" />
        <package name="lucide-react" version="^0.552.0" />
        <package name="tailwindcss" version="^4.1.16" />
        <package name="clsx" version="^2.1.1" />
        <package name="tailwind-merge" version="^3.3.1" />
        <package name="zustand" version="^5.0.8" />
        <package name="@testing-library/react" version="^16.3.0" />
        <package name="@testing-library/jest-dom" version="^6.9.1" />
        <package name="@playwright/test" version="^1.56.1" />
        <package name="vitest" version="^4.0.7" />
      </node>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Follow existing component patterns in src/components/common/</constraint>
    <constraint>Use composition pattern: base EmptyState + variant-specific content</constraint>
    <constraint>Use localStorage for persistence (tooltips, onboarding state) - follow ShortcutContext pattern</constraint>
    <constraint>Integrate error states with existing ErrorBoundary.tsx</constraint>
    <constraint>Use Lucide icons for consistency with existing components</constraint>
    <constraint>Follow UX design colors: Cyan primary (#06B6D4), Slate neutrals</constraint>
    <constraint>Animation timing: 150-200ms ease transitions</constraint>
    <constraint>Tone: Calm, direct, reassuring - empty state as encouragement</constraint>
    <constraint>All components must have ARIA labels for accessibility</constraint>
    <constraint>Focus management for modal tooltips following ShortcutOverlay pattern</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>EmptyStateProps</name>
      <kind>component props</kind>
      <signature>{ icon?: ReactNode; title: string; description?: string; action?: ReactNode; className?: string }</signature>
      <path>src/components/common/EmptyState.tsx</path>
    </interface>
    <interface>
      <name>useOnboardingState</name>
      <kind>hook</kind>
      <signature>() => { isFirstLaunch: boolean; markOnboardingComplete: () => void; reset: () => void }</signature>
      <path>src/hooks/useOnboardingState.ts</path>
    </interface>
    <interface>
      <name>useFirstTimeTooltip</name>
      <kind>hook</kind>
      <signature>(tooltipId: string) => { isVisible: boolean; dismiss: () => void; reset: () => void }</signature>
      <path>src/hooks/useFirstTimeTooltip.ts</path>
    </interface>
    <interface>
      <name>ErrorStateProps</name>
      <kind>component props</kind>
      <signature>{ type: 'network' | 'auth' | 'sync' | 'generic'; message?: string; onRetry?: () => void; onSecondaryAction?: () => void }</signature>
      <path>src/components/common/ErrorState.tsx</path>
    </interface>
  </interfaces>

  <tests>
    <standards>Use Vitest for unit tests with @testing-library/react. E2E tests use Playwright. Follow tagging convention (@ui for UI tests). Component tests include render, interaction, and accessibility tests. Mock localStorage for persistence tests.</standards>
    <locations>
      <location>src/components/common/__tests__/</location>
      <location>src/components/onboarding/__tests__/</location>
      <location>src/hooks/__tests__/</location>
      <location>e2e/</location>
    </locations>
    <ideas>
      <idea ac="1">E2E test: First launch shows welcome screen with Connect Email CTA, clicking CTA triggers OAuth flow</idea>
      <idea ac="2">Unit test: EmptyInbox renders checkmark icon and "You're all caught up" message</idea>
      <idea ac="3">Unit test: EmptySearch renders search tips when no results; integration test with SearchResults</idea>
      <idea ac="4">Unit test: SyncProgress shows progress bar with percentage and estimated time</idea>
      <idea ac="5">Unit test: ErrorState variants render correct messages and action buttons; integration with ErrorBoundary</idea>
      <idea ac="6">Unit test: useFirstTimeTooltip returns isVisible=true on first render, false after dismiss; persists to localStorage</idea>
      <idea ac="1-6">E2E test: Complete onboarding flow from first launch to inbox view</idea>
      <idea ac="1-6">Accessibility test: All empty states have ARIA labels, focus management works with keyboard</idea>
    </ideas>
  </tests>
</story-context>
