<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>17</storyId>
    <title>Apply UX Design System to All Components</title>
    <status>drafted</status>
    <generatedAt>2025-12-15</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/2-17-apply-ux-design-system.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>user</asA>
    <iWant>the application to have a polished, professional interface following the UX Design Specification</iWant>
    <soThat>the experience matches the quality expected of a premium email client</soThat>
    <tasks>
      <task id="1" ac="1,2,3,4,5,7">Setup Design System Tokens
        <subtask id="1.1">Update tailwind.config.ts with color tokens (Primary #06B6D4, Success #10B981, Warning #F59E0B, Error #EF4444, Slate neutrals)</subtask>
        <subtask id="1.2">Configure typography (Inter Variable, type scale h1-caption, letter-spacing)</subtask>
        <subtask id="1.3">Configure spacing scale (xs:4px through 3xl:48px)</subtask>
        <subtask id="1.4">Add border-radius tokens (sm:4px, md:6px, lg:8px, xl:12px)</subtask>
        <subtask id="1.5">Add shadow tokens (subtle, modal)</subtask>
        <subtask id="1.6">Configure dark mode colors</subtask>
      </task>
      <task id="2" ac="2">Add Inter Variable Font
        <subtask id="2.1">Install Inter Variable font via Google Fonts or self-hosted</subtask>
        <subtask id="2.2">Configure font-face in CSS</subtask>
        <subtask id="2.3">Set as default font-family in Tailwind config</subtask>
      </task>
      <task id="3" ac="6,11">Update Core UI Components
        <subtask id="3.1">Update button.tsx variants (Primary: Cyan, Secondary: Gray, Tertiary: Text)</subtask>
        <subtask id="3.2">Update input.tsx styling (border-radius 6px, Slate 300 border, Cyan focus)</subtask>
        <subtask id="3.3">Update badge/pill components with spec colors</subtask>
        <subtask id="3.4">Update toast notifications with spec styling</subtask>
        <subtask id="3.5">Update dialog/modal styling with spec shadows and radius</subtask>
        <subtask id="3.6">Update card.tsx border radius (8px) and subtle shadow</subtask>
      </task>
      <task id="4" ac="8">Update EmailListItem Component
        <subtask id="4.1">Apply 48px compact row height</subtask>
        <subtask id="4.2">Style confidence badges (green/yellow/red pills)</subtask>
        <subtask id="4.3">Add AI chip styling (DRAFT READY, AI)</subtask>
        <subtask id="4.4">Apply selected state styling (cyan border left)</subtask>
        <subtask id="4.5">Apply read/unread text weight difference</subtask>
        <subtask id="4.6">Add hover background state</subtask>
        <subtask id="4.7">Update padding: 8px vertical, 12px horizontal</subtask>
        <subtask id="4.8">Update VirtualEmailList.tsx ESTIMATED_ROW_HEIGHT to 48px</subtask>
      </task>
      <task id="5" ac="9">Update ThreadDetailView Component
        <subtask id="5.1">Apply thread panel layout per spec</subtask>
        <subtask id="5.2">Style thread messages with proper spacing</subtask>
        <subtask id="5.3">Add collapsible sections for quoted text</subtask>
        <subtask id="5.4">Style action buttons per spec</subtask>
        <subtask id="5.5">Update ThreadMessage.tsx styling (cyan border for sent, proper spacing)</subtask>
      </task>
      <task id="6" ac="10">Update CommandPalette Component
        <subtask id="6.1">Apply modal overlay with backdrop blur</subtask>
        <subtask id="6.2">Style search input per spec</subtask>
        <subtask id="6.3">Add keyboard shortcut hints in results</subtask>
        <subtask id="6.4">Apply category labels (Actions, Navigation, Search)</subtask>
        <subtask id="6.5">Update SearchInput.tsx with cyan focus ring (#06B6D4)</subtask>
        <subtask id="6.6">Update SearchResults.tsx highlighting with cyan</subtask>
      </task>
      <task id="7" ac="6">Update Sidebar/Navigation
        <subtask id="7.1">Apply 180px fixed width per spec</subtask>
        <subtask id="7.2">Style navigation items (Inbox, Starred, Sent, etc.)</subtask>
        <subtask id="7.3">Add priority label styling (color-coded)</subtask>
        <subtask id="7.4">Style account switcher dropdown</subtask>
        <subtask id="7.5">Update AccountList.tsx card styling per spec</subtask>
      </task>
      <task id="8" ac="12">Update Empty States
        <subtask id="8.1">Apply spec styling to EmptyInbox component</subtask>
        <subtask id="8.2">Apply spec styling to EmptySearch component</subtask>
        <subtask id="8.3">Apply spec styling to EmptyFolder component</subtask>
        <subtask id="8.4">Add friendly, encouraging tone to copy</subtask>
      </task>
      <task id="9" ac="6">Update Compose Dialog
        <subtask id="9.1">Apply spec styling to compose form</subtask>
        <subtask id="9.2">Style recipient input per spec</subtask>
        <subtask id="9.3">Style attachment area</subtask>
        <subtask id="9.4">Apply action button styling</subtask>
      </task>
      <task id="10" ac="6">Update Settings Components
        <subtask id="10.1">Apply card styling per spec</subtask>
        <subtask id="10.2">Update form inputs</subtask>
        <subtask id="10.3">Style toggle switches</subtask>
        <subtask id="10.4">Apply section headers</subtask>
      </task>
      <task id="11" ac="6">Update Sync Components
        <subtask id="11.1">Update ConflictResolutionDialog.tsx modal styling (cyan accents, spec shadow)</subtask>
        <subtask id="11.2">Update RetryIndicator.tsx progress styling (cyan progress bar)</subtask>
      </task>
      <task id="12" ac="1-12">Visual QA and Consistency Check
        <subtask id="12.1">Review all components for color token usage</subtask>
        <subtask id="12.2">Verify typography consistency</subtask>
        <subtask id="12.3">Check spacing consistency</subtask>
        <subtask id="12.4">Test dark mode</subtask>
        <subtask id="12.5">Fix any visual inconsistencies</subtask>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="1">Color system tokens defined in Tailwind config matching UX spec (Cyan #06B6D4 primary, Slate neutrals)</criterion>
    <criterion id="2">Typography uses Inter Variable font with specified sizes (H1: 24px, Body: 14px, etc.)</criterion>
    <criterion id="3">Spacing follows 4px base, 8px rhythm (xs: 4px, sm: 8px, md: 12px, lg: 16px, xl: 24px)</criterion>
    <criterion id="4">Border radius follows spec (small: 4px, medium: 6px, large: 8px, extra-large: 12px)</criterion>
    <criterion id="5">Shadows follow spec (subtle: 0 1px 3px rgba(0,0,0,0.1), modal: 0 8px 24px rgba(0,0,0,0.15))</criterion>
    <criterion id="6">All components updated to use design tokens instead of hardcoded values</criterion>
    <criterion id="7">Dark mode palette implemented as specified</criterion>
    <criterion id="8">EmailListItem matches UX spec (48px height, confidence badges, AI chips)</criterion>
    <criterion id="9">ThreadDetailView follows spec layout (thread panel with collapsible sections)</criterion>
    <criterion id="10">CommandPalette styled per spec (overlay with backdrop, type-ahead filtering)</criterion>
    <criterion id="11">All buttons follow primary/secondary/tertiary styling from spec</criterion>
    <criterion id="12">Empty states follow spec patterns (encouragement, friendly tone)</criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/ux-design-specification.md</path>
        <title>UX Design Specification</title>
        <section>Complete Design System</section>
        <snippet>Primary design reference. Defines color system (Cyan #06B6D4), typography (Inter Variable), spacing (4px base), border-radius, shadows, and 10 custom component specifications.</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-directions.html</path>
        <title>UX Design Directions</title>
        <section>Layout Mockups</section>
        <snippet>Interactive mockups for 6 design directions. Chosen: Hybrid Direction 1+2 (Classic 3-Pane + Command Palette). Contains CSS specifications for EmailListItem, CommandPalette.</snippet>
      </doc>
      <doc>
        <path>docs/ux-color-themes.html</path>
        <title>UX Color Themes</title>
        <section>Theme 3: Technical Calm</section>
        <snippet>Color theme mockups. Chosen: Theme 3 with Cyan 500 (#06B6D4) primary, Slate neutrals, semantic colors (Success #10B981, Warning #F59E0B, Error #EF4444).</snippet>
      </doc>
      <doc>
        <path>docs/ux-gap-analysis.md</path>
        <title>UX Gap Analysis</title>
        <section>Component Cross-Reference</section>
        <snippet>Gap analysis between UX spec and implementation. Lists 28 components requiring updates with current vs target state. Story-to-task mapping confirms 100% coverage.</snippet>
      </doc>
      <doc>
        <path>docs/brownfield/component-library-ui-patterns.md</path>
        <title>Component Library Reference</title>
        <section>Base UI Components</section>
        <snippet>Documents 33 shadcn/ui base components from v1. Includes Button, Input, Card, Dialog, Badge with Radix primitives. Identifies improvement areas for v2.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Decision Document</title>
        <section>Styling Stack</section>
        <snippet>Confirms TailwindCSS 4.0 + shadcn/ui for styling. 5x faster builds with Rust Oxide engine. CSS-first config pattern for design tokens.</snippet>
      </doc>
      <doc>
        <path>docs/testing.md</path>
        <title>Testing Infrastructure</title>
        <section>Test Structure</section>
        <snippet>Defines test locations: src/components/*/__tests__/ for component tests, e2e/ for E2E tests. Vitest 4.0 for unit tests, Playwright for E2E.</snippet>
      </doc>
    </docs>
    <code>
      <!-- Configuration Files -->
      <file>
        <path>tailwind.config.ts</path>
        <kind>config</kind>
        <symbol>theme.extend</symbol>
        <lines>10-12</lines>
        <reason>Currently empty - needs color tokens, typography, spacing, border-radius, shadows</reason>
      </file>
      <file>
        <path>src/index.css</path>
        <kind>stylesheet</kind>
        <symbol>:root CSS variables</symbol>
        <lines>8-30</lines>
        <reason>Contains CSS variables using navy primary (222.2 47.4% 11.2%) - needs cyan (#06B6D4)</reason>
      </file>

      <!-- Base UI Components (shadcn) -->
      <file>
        <path>src/shared/components/ui/button.tsx</path>
        <kind>component</kind>
        <symbol>buttonVariants</symbol>
        <lines>7-32</lines>
        <reason>Uses CSS variables - will inherit cyan after CSS update. May need tertiary variant.</reason>
      </file>

      <!-- HIGH PRIORITY - Email Components -->
      <file>
        <path>src/components/email/EmailRow.tsx</path>
        <kind>component</kind>
        <symbol>EmailRow</symbol>
        <reason>Main email row component. Currently no explicit height - needs 48px. Selection states use blue.</reason>
      </file>
      <file>
        <path>src/components/email/EmailListItem.tsx</path>
        <kind>component</kind>
        <symbol>EmailListItem</symbol>
        <lines>127</lines>
        <reason>Uses blue-50, blue-500 for selection. Needs cyan-50, cyan-500.</reason>
      </file>
      <file>
        <path>src/components/email/VirtualEmailList.tsx</path>
        <kind>component</kind>
        <symbol>ESTIMATED_ROW_HEIGHT</symbol>
        <lines>58</lines>
        <reason>Currently 88px - needs to be 48px per UX spec</reason>
      </file>
      <file>
        <path>src/components/email/ThreadDetailView.tsx</path>
        <kind>component</kind>
        <symbol>ThreadDetailView</symbol>
        <lines>48,120</lines>
        <reason>Uses blue-600, blue-500 for loading spinner and focus rings</reason>
      </file>
      <file>
        <path>src/components/email/ThreadMessage.tsx</path>
        <kind>component</kind>
        <symbol>ThreadMessage</symbol>
        <reason>Needs cyan border for sent messages, proper spacing per spec</reason>
      </file>
      <file>
        <path>src/components/email/FolderSidebar.tsx</path>
        <kind>component</kind>
        <symbol>FolderSidebar</symbol>
        <reason>Sidebar navigation - needs 200px width, cyan active states</reason>
      </file>

      <!-- MEDIUM PRIORITY - Search Components -->
      <file>
        <path>src/components/search/CommandPalette.tsx</path>
        <kind>component</kind>
        <symbol>CommandPalette</symbol>
        <lines>509</lines>
        <reason>Uses blue-50 for selection. Needs cyan-50, backdrop blur, spec shadow.</reason>
      </file>
      <file>
        <path>src/components/search/SearchInput.tsx</path>
        <kind>component</kind>
        <symbol>SearchInput</symbol>
        <lines>145</lines>
        <reason>Uses blue-500 focus ring. Needs cyan-500 (#06B6D4).</reason>
      </file>
      <file>
        <path>src/components/search/SearchResultItem.tsx</path>
        <kind>component</kind>
        <symbol>SearchResultItem</symbol>
        <lines>95,135</lines>
        <reason>Uses blue-50, blue-500 for selection and unread indicator.</reason>
      </file>

      <!-- MEDIUM PRIORITY - Compose Components -->
      <file>
        <path>src/components/compose/ComposeDialog.tsx</path>
        <kind>component</kind>
        <symbol>ComposeDialog</symbol>
        <lines>393</lines>
        <reason>Uses blue-600, blue-800 for links. Needs spec styling.</reason>
      </file>
      <file>
        <path>src/components/compose/RecipientInput.tsx</path>
        <kind>component</kind>
        <symbol>RecipientInput</symbol>
        <reason>Needs cyan focus ring and tag styling per spec.</reason>
      </file>
      <file>
        <path>src/components/compose/AttachmentUpload.tsx</path>
        <kind>component</kind>
        <symbol>AttachmentUpload</symbol>
        <lines>247,274</lines>
        <reason>Uses blue-50, blue-300, blue-600 for drag state. Needs cyan.</reason>
      </file>

      <!-- MEDIUM PRIORITY - Account Components -->
      <file>
        <path>src/components/account/AccountSwitcher.tsx</path>
        <kind>component</kind>
        <symbol>AccountSwitcher</symbol>
        <reason>Needs cyan highlights for active account.</reason>
      </file>
      <file>
        <path>src/components/account/AccountListItem.tsx</path>
        <kind>component</kind>
        <symbol>AccountListItem</symbol>
        <reason>Needs card styling per spec.</reason>
      </file>

      <!-- MEDIUM PRIORITY - Sync/Conflict Components -->
      <file>
        <path>src/components/conflicts/ConflictResolutionModal.tsx</path>
        <kind>component</kind>
        <symbol>ConflictResolutionModal</symbol>
        <lines>110-128</lines>
        <reason>Uses blue-200, blue-50, blue-900, blue-700, blue-100. Needs cyan accents.</reason>
      </file>
      <file>
        <path>src/components/email/BulkActionBar.tsx</path>
        <kind>component</kind>
        <symbol>BulkActionBar</symbol>
        <lines>80-171</lines>
        <reason>Heavy blue usage (blue-50, blue-200, blue-700, blue-900, blue-800, blue-600, blue-100, blue-500). Needs cyan.</reason>
      </file>

      <!-- LOWER PRIORITY - Empty States (mostly correct) -->
      <file>
        <path>src/components/common/EmptyInbox.tsx</path>
        <kind>component</kind>
        <symbol>EmptyInbox</symbol>
        <reason>Uses cyan-500 - verify styling matches spec.</reason>
      </file>
      <file>
        <path>src/components/common/EmptySearch.tsx</path>
        <kind>component</kind>
        <symbol>EmptySearch</symbol>
        <reason>Uses slate colors - verify matches spec.</reason>
      </file>
      <file>
        <path>src/components/common/EmptyFolder.tsx</path>
        <kind>component</kind>
        <symbol>EmptyFolder</symbol>
        <reason>Follows pattern - verify matches spec.</reason>
      </file>

      <!-- Settings Components -->
      <file>
        <path>src/components/settings/StorageSettingsWidget.tsx</path>
        <kind>component</kind>
        <symbol>StorageSettingsWidget</symbol>
        <lines>38,44,196</lines>
        <reason>Uses blue-600, blue-500 for progress. Needs cyan.</reason>
      </file>
      <file>
        <path>src/components/settings/attributes/AttributeCard.tsx</path>
        <kind>component</kind>
        <symbol>AttributeCard</symbol>
        <reason>Card styling - needs spec border-radius and shadow.</reason>
      </file>
    </code>
    <dependencies>
      <node>
        <package name="tailwindcss" version="^4.1.16" dev="true">CSS framework - 4.0 with Rust Oxide engine for 5x faster builds</package>
        <package name="tailwindcss-animate" version="^1.0.7" dev="true">Animation utilities for Tailwind</package>
        <package name="tailwind-merge" version="^3.3.1" dev="true">Utility for merging Tailwind classes without conflicts</package>
        <package name="class-variance-authority" version="^0.7.1" dev="true">CVA for type-safe component variants (used in button.tsx)</package>
        <package name="clsx" version="^2.1.1" dev="true">Class name utility for conditional classes</package>
        <package name="@radix-ui/react-slot" version="^1.2.3" dev="true">Radix slot for polymorphic components (used in shadcn Button)</package>
        <package name="lucide-react" version="^0.552.0" dev="true">Icon library (1000+ icons, consistent with shadcn/ui)</package>
        <package name="react" version="19.2">React 19.2 with improved hooks</package>
        <package name="react-dom" version="19.2">React DOM for web rendering</package>
        <package name="@tanstack/react-virtual" version="^3.13.12">Virtualization for 10K+ email list (ESTIMATED_ROW_HEIGHT: 88â†’48)</package>
        <package name="zustand" version="^5.0.8">State management for theme/dark mode persistence</package>
      </node>
      <notes>
        <note>Inter Variable font not yet installed - add via Google Fonts or self-host</note>
        <note>No additional dependencies needed for UX design system - all styling through Tailwind/CSS</note>
      </notes>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="pattern">Use CSS variables for colors (--primary, --secondary, etc.) to enable theme switching</constraint>
    <constraint type="pattern">Tailwind 4.0 CSS-first config - extend theme in tailwind.config.ts</constraint>
    <constraint type="pattern">shadcn/ui components use CSS variables - updating index.css propagates to all components</constraint>
    <constraint type="standard">Colors: Primary Cyan #06B6D4, Success #10B981, Warning #F59E0B, Error #EF4444</constraint>
    <constraint type="standard">Typography: Inter Variable font, 14px body, 24px h1</constraint>
    <constraint type="standard">Spacing: 4px base unit, 8px rhythm (xs:4, sm:8, md:12, lg:16, xl:24, 2xl:32, 3xl:48)</constraint>
    <constraint type="standard">Border radius: sm 4px, md 6px, lg 8px, xl 12px</constraint>
    <constraint type="standard">Shadows: subtle (0 1px 3px rgba(0,0,0,0.1)), modal (0 8px 24px rgba(0,0,0,0.15))</constraint>
    <constraint type="layout">Email row height: 48px compact</constraint>
    <constraint type="layout">Sidebar width: 200px fixed</constraint>
    <constraint type="layout">Command palette: 600px width, 0 24px 48px rgba(0,0,0,0.3) shadow</constraint>
  </constraints>
  <interfaces>
    <interface>
      <name>CSS Variables (shadcn)</name>
      <kind>CSS custom properties</kind>
      <signature>--primary, --primary-foreground, --secondary, --accent, --destructive, --border, --ring</signature>
      <path>src/index.css</path>
    </interface>
    <interface>
      <name>Tailwind Theme Extension</name>
      <kind>config object</kind>
      <signature>theme.extend.colors, theme.extend.fontFamily, theme.extend.spacing, theme.extend.borderRadius, theme.extend.boxShadow</signature>
      <path>tailwind.config.ts</path>
    </interface>
    <interface>
      <name>buttonVariants (CVA)</name>
      <kind>class-variance-authority variants</kind>
      <signature>variant: default | destructive | outline | secondary | ghost | link; size: default | sm | lg | icon</signature>
      <path>src/shared/components/ui/button.tsx</path>
    </interface>
  </interfaces>
  <tests>
    <standards>Vitest 4.0 for unit tests with @testing-library/react. Playwright 1.56 for E2E visual regression. Use test tags (@perf, @visual) for categorization. Component tests in __tests__ folders alongside components. Visual tests should verify color tokens, spacing, and responsive behavior.</standards>
    <locations>
      <location>src/components/**/__tests__/*.test.tsx</location>
      <location>e2e/*.spec.ts</location>
    </locations>
    <ideas>
      <idea ac="1">Test Tailwind config exports correct color tokens (cyan-500: #06B6D4)</idea>
      <idea ac="2">Test Inter font is loaded and applied to body element</idea>
      <idea ac="3">Test spacing utility classes produce correct pixel values</idea>
      <idea ac="4">Test border-radius tokens (rounded-sm: 4px, rounded-md: 6px, etc.)</idea>
      <idea ac="5">Test shadow utility classes produce correct box-shadow values</idea>
      <idea ac="6">Visual regression: screenshot comparison before/after design system update</idea>
      <idea ac="7">Test dark mode toggle switches CSS variables correctly</idea>
      <idea ac="8">Test EmailListItem renders at 48px height with correct selection colors</idea>
      <idea ac="9">Test ThreadDetailView layout matches spec dimensions</idea>
      <idea ac="10">Test CommandPalette renders with backdrop blur and correct shadow</idea>
      <idea ac="11">Test Button variants (primary/secondary/tertiary) apply correct colors</idea>
      <idea ac="12">Test EmptyInbox/EmptySearch/EmptyFolder use cyan-500 icons and friendly copy</idea>
    </ideas>
  </tests>
</story-context>
